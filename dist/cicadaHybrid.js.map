{"version":3,"file":"cicadaHybrid.js","sources":["webpack:///webpack/bootstrap 490bb9e6afd907fb3efc","webpack:///src/core/native-socket.js","webpack:///src/config.js","webpack:///src/util/util.js","webpack:///src/ui/ui.js","webpack:///src/ui/toast.js","webpack:///src/ui/alert.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/src/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 490bb9e6afd907fb3efc\n **/","/**\n * js与原生通讯方案\n * sherlock221b\n * 核心部分参考 https://github.com/chemdemo/hybrid-js/blob/master/lib/core.js\n */\n\n\nimport {SCHEMA,API_ROOT,UA,OS_NAME,DE_BUG} from \"../config\";\nimport Util from \"../util/util\";\n\nvar HybridJS = {};\nconst REQUEST_FUN_BACK = 'req_fun';\nconst RESPONSE_FUN_BACK = 'res_fun';\nconst WEB_CB_SN_PREFIX = '__ca_';\nconst SLICE = Array.prototype.slice;\n\nconst CALLBACKS = {};\n\nclass NativeSocket {\n\n    constructor() {\n        HybridJS = Util.getRoot();\n        let m = UA.match(new RegExp(OS_NAME + '\\\\/([^\\\\/]+)\\\\/(\\\\d+)'));\n        console.log(m);\n    }\n\n    /**\n     * js调用原生api\n     * @param api\n     * @param params\n     * @param callBack\n     * @returns {boolean}\n     */\n    invokeNative(api, params, callBack) {\n        if (!api) throw Error(\"api 未填写...\");\n\n        //api名称\n        let names = api.split(/\\.|\\//);\n        let method = names.pop();\n        let ns;\n        let fn;\n\n        if (!names.length || !method) throw Error('api ' + api + ' has not assigned');\n        ns = names.join('/');\n\n        //检测回调函数\n        if(callBack && Util.isFn(callBack)){\n            //注册一个回调函数\n            fn = this._callbackSign(\n                api,\n                callBack,\n                params.context || HybridJS,\n                params.nextTick !== undefined ? params.nextTick : true\n            );\n\n            delete params.callback;\n            delete params.context;\n            delete params.nextTick;\n        }\n\n        //组装url\n        let url = `${SCHEMA}://${ns}/${method}`;\n\n        //回调函数\n        if(fn)  params[REQUEST_FUN_BACK] = fn;\n\n\n        //参数进行封装\n        if(params){\n            url += this._encodeParam(params);\n        }\n\n        if(fn) delete params[REQUEST_FUN_BACK];\n\n        Util.log(\"编译前的: \",decodeURIComponent(url));\n        Util.log(\"编译后的: \",url);\n\n        //执行\n        this._invokeByUrlSchema(url);\n\n        //如果有回调函数则返回标识\n        return fn;\n    };\n\n\n    /**\n     * 1.native回调web\n     * 2.调用web方法\n     * @param api\n     * @param str\n     */\n    invokeWeb(api,str) {\n        if (typeof api !== 'string' || (str && typeof str !== 'string')) throw Error('参数不合法，必须是字符串');\n\n        let params;\n\n        //解码\n        str = decodeURIComponent(str);\n\n        try {\n            params = JSON.parse(str);\n        } catch (e) {\n            if (/{/.test(str)) throw e;\n            params = null;\n        }\n\n        Util.log(\"app发送的参数: \",JSON.stringify(params));\n\n        let responseFun = params ? params[RESPONSE_FUN_BACK] : null;\n        //调用回调函数\n        if(responseFun){\n            let callback = this._findCallback(api, responseFun);\n            delete params[RESPONSE_FUN_BACK];\n\n            if(Util.isFn(callback)){\n                callback(params.data);\n            }\n\n\n            return;\n        }\n        //发送事件\n        else{\n            Util.log(\"发送事件\");\n        }\n    };\n\n\n    _encodeParam(params) {\n        let i = 0;\n        let baseUrl = \"\";\n        for(let p in params){\n            baseUrl += `${i == 0 ? '?' : \"&\" }${p}=${params[p]}`;\n            i++;\n        }\n        return encodeURIComponent(baseUrl);\n    };\n\n\n    //注册一个回调函数\n    _callbackSign(api, callback, context, nextTick){\n        if(Util.isFn(callback)) {\n            api = api.replace(/\\./g, '/');\n\n            let sn = WEB_CB_SN_PREFIX + Date.now();\n            let map = CALLBACKS[api] || (CALLBACKS[api] = {});\n            // let map = createNamespace(CALLBACKS, api.split(/\\./));\n            // 注意，箭头函数没有arguments！！\n            map[sn] = function(value) {\n                let args = SLICE.call(arguments);\n\n                if(!nextTick) {\n                    callback.apply(context, args);\n                } else {\n                    setTimeout(() => {\n                        callback.apply(context, args);\n                    }, 0);\n                }\n\n                delete map[sn];\n            };\n\n            return sn;\n        }\n\n        return '';\n    };\n\n    _invokeByUrlSchema(url){\n        window.location.href = url;\n    };\n\n    _findCallback(api, sn) {\n        api = api.replace(/\\./g, '/')\n        return (CALLBACKS[api] || {})[sn];\n    }\n\n}\n\nvar ns = new NativeSocket();\n\nHybridJS.core = ns;\n\nmodule.exports = ns;\n\n\n\n\n/** WEBPACK FOOTER **\n ** src/core/native-socket.js\n **/","//私有协议\nconst SCHEMA = \"cicada\";\n//暴露出来的API标识\nconst API_ROOT = \"HybridJS\";\n//浏览器ua\nconst UA = window.navigator.userAgent;\n//系统名称\nconst OS_NAME = \"cicada\";\nconst DE_BUG = true;\n\n\nmodule .exports = {\n    SCHEMA : SCHEMA,\n    API_ROOT : API_ROOT,\n    UA : UA,\n    OS_NAME : OS_NAME,\n    DE_BUG  : DE_BUG\n}\n\n\n/** WEBPACK FOOTER **\n ** src/config.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\nimport {UA,DE_BUG,API_ROOT} from \"../config\";\n\n\nexport  default class Util {\n\n    /**\n     * 调试\n      * @param message\n     */\n    static log(){\n        var message = '';\n        if(DE_BUG){\n            for(var i =0; i<arguments.length;i++){\n                message += arguments[i];\n            }\n            console.log(message);\n        }\n    }\n\n    static getRoot(){\n        if(!window[API_ROOT])\n            window[API_ROOT] = {};\n\n        return window[API_ROOT];\n    };\n\n    static isFn(fn) {\n        return typeof fn === 'function';\n    }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** src/util/util.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\n\n\nimport Util  from  \"../util/util\";\nimport Toast from \"./toast\";\nimport Alert from \"./alert\";\n\nUtil.getRoot().ui = {\n    toast : Toast,\n    alert : Alert\n};\n\n\n/** WEBPACK FOOTER **\n ** src/ui/ui.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\nimport Util from  \"../util/util\";\nlet HybridJS = Util.getRoot();\n\nexport  default class Toast {\n\n    static show(message, duration) {\n        duration = duration || 2000;\n        HybridJS.core.invokeNative(\"ui.toast\", {message: message, display: true, duration: duration});\n    };\n\n    static hide() {\n        HybridJS.core.invokeNative(\"ui.toast\", {display: false});\n    }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** src/ui/toast.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\nimport Util from  \"../util/util\";\nlet HybridJS = Util.getRoot();\n\nexport  default class Alert {\n\n    static show(message) {\n        HybridJS.core.invokeNative(\"ui.alert\", {message: message, display: true});\n    };\n\n    static hide() {\n        HybridJS.core.invokeNative(\"ui.alert\", {display: false});\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** src/ui/alert.js\n **/"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAFA;AACA;AAEA;AACA;AACA;AAHA;AACA;;;;;;;;;;AAHA;;AAeA;AACA;AACA;;AAFA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;;AAXA;;AAeA;AACA;AAMA;AACA;AACA;AAXA;AACA;;AAdA;AACA;;AADA;AACA;;AADA;AAoCA;AADA;AACA;AAGA;AACA;AACA;AACA;AACA;;AA3CA;AACA;;AADA;;;;;;;;;;;;AA0DA;AACA;AACA;AACA;AACA;;AAJA;AACA;AAOA;AACA;AADA;AAGA;AACA;AAFA;AACA;AAIA;AACA;AACA;;AAjBA;AAoBA;AACA;AACA;AACA;AACA;AADA;AACA;AAIA;;;AATA;AAaA;AAbA;;;;AAkBA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;;;;;;;AAKA;AACA;;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AADA;AAHA;AACA;AAOA;AAXA;AACA;AAaA;AAAA;AAAA;AArBA;AACA;;AADA;AACA;AAuBA;;;;AAGA;AACA;;;;AAGA;AACA;AACA;;;;AA5JA;;;AAiKA;AACA;AACA;AACA;;;;;;;;;;ACrLA;;AAEA;;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AALA;;;;;;;;;;;;;;;;;;;;ACJA;;;;;;;;;;;;;AAMA;AACA;AACA;AACA;AACA;AADA;AAGA;AAJA;;;;AAQA;AACA;AACA;AAEA;;;;AAGA;AACA;;;;AAxBA;;;;;;;;;;;;;;;;;;;;;;;;;ACGA;AACA;AACA;AAFA;;;;;;;;;;;;;;;;;;;;;;;;;;ACLA;AACA;AACA;;;;;;;AAEA;AACA;AACA;;;;AAGA;AACA;;;;AARA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;;;;;;;AAEA;AACA;;;;AAGA;AACA;;;;AAPA;;;;;;","sourceRoot":""}