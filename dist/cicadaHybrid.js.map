{"version":3,"file":"cicadaHybrid.js","sources":["webpack:///webpack/bootstrap 5a4a3838e43396db405d","webpack:///src/core/native-socket.js","webpack:///src/config.js","webpack:///src/util/util.js","webpack:///src/core/event-model.js","webpack:///src/ui/ui.js","webpack:///src/ui/toast.js","webpack:///src/ui/dialog.js","webpack:///src/navigation/navigation.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/src/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 5a4a3838e43396db405d\n **/","/**\n * js与原生通讯方案\n * sherlock221b\n * 核心部分参考 https://github.com/chemdemo/hybrid-js/blob/master/lib/core.js\n */\n\n\nimport {SCHEMA,API_ROOT,UA,OS_NAME,DE_BUG,SOURCE} from \"../config\";\nimport Util from \"../util/util\";\nimport EventModel from \"./event-model\";\n\nvar HybridJS = {};\nconst REQUEST_FUN_BACK = 'req_fun';\nconst RESPONSE_FUN_BACK = 'res_fun';\nconst WEB_CB_SN_PREFIX = '__ca_';\nconst SLICE = Array.prototype.slice;\n\nconst CALLBACKS = {};\n\nclass NativeSocket {\n\n\n    constructor() {\n        HybridJS = Util.getRoot();\n        let m = UA.match(new RegExp(OS_NAME + '\\\\/([^\\\\/]+)\\\\/(\\\\d+)'));\n        console.log(m);\n\n        //事件模型暴露\n        HybridJS.event = EventModel;\n    }\n\n\n    /**\n     * js调用原生api\n     * @param api\n     * @param params\n     * @param callBack\n     * @returns {boolean}\n     */\n    invokeNative(api, params, callBack) {\n        if (!api) throw Error(\"api 未填写...\");\n\n        //api名称\n        let names = api.split(/\\.|\\//);\n        let method = names.pop();\n        let ns;\n        let fn;\n\n        if (!names.length || !method) throw Error('api ' + api + ' has not assigned');\n        ns = names.join('/');\n\n        //检测回调函数\n        if(callBack && Util.isFn(callBack)){\n            //注册一个回调函数\n            fn = this._callbackSign(\n                api,\n                callBack,\n                params.context || HybridJS,\n                params.nextTick !== undefined ? params.nextTick : true\n            );\n\n            delete params.callback;\n            delete params.context;\n            delete params.nextTick;\n        }\n\n        Util.log(\"当前回调函数栈: \",CALLBACKS);\n\n        //组装url\n        let url = `${SCHEMA}://${SOURCE}/${ns}/${method}`;\n\n        //回调函数\n        if(fn)  params[REQUEST_FUN_BACK] = fn;\n\n        //参数进行封装\n        if(params){\n            url += this._encodeParam(params);\n        }\n\n        if(fn) delete params[REQUEST_FUN_BACK];\n\n        Util.log(\"编译前的: \",decodeURIComponent(url));\n        Util.log(\"编译后的: \",url);\n\n        //执行\n        this._invokeByUrlSchema(url);\n\n        //如果有回调函数则返回标识\n        return fn;\n    };\n\n\n    /**\n     * 1.native回调web\n     * 2.调用web方法\n     * @param api\n     * @param str\n     */\n    invokeWeb(api,str) {\n        if (typeof api !== 'string' || (str && typeof str !== 'string')) throw Error('参数不合法，必须是字符串');\n\n        let params;\n\n        //解码\n        str = decodeURIComponent(str);\n\n        try {\n            params = JSON.parse(str);\n        } catch (e) {\n            if (/{/.test(str)) throw e;\n            params = null;\n        }\n\n        Util.log(\"app发送的参数: \",JSON.stringify(params));\n\n        let responseFun = params ? params[RESPONSE_FUN_BACK] : null;\n\n        //调用回调函数\n        if(responseFun){\n            let callback = this._findCallback(api, responseFun);\n            delete params[RESPONSE_FUN_BACK];\n\n            if(Util.isFn(callback)){\n                callback(params.data);\n            }\n            return;\n        }\n        //主动通知web\n        else{\n            Util.log(\"发送事件\");\n            if(/^sdk(?:\\.|\\/)notify/.test(api) && params) {\n                let data = params.data || {}\n                EventModel.emit(params.event, data);\n                return;\n            }\n        }\n    };\n\n    _encodeParam(params) {\n        let i = 0;\n        let baseUrl = \"\";\n        for(let p in params){\n            baseUrl += `${i == 0 ? '?' : \"&\" }${p}=${params[p]}`;\n            i++;\n        }\n        return encodeURIComponent(baseUrl);\n    };\n\n\n    /**\n     * 开放注册回调函数\n     * @returns {*}\n     */\n    registerCallBack(api,callBack,params){\n        params = params || {};\n       let fn =  this._callbackSign(\n            api,\n            callBack,\n            params.context || HybridJS,\n            params.nextTick !== undefined ? params.nextTick : true\n        );\n        console.log(CALLBACKS);\n\n        return fn;\n    };\n\n\n    //注册一个回调函数\n    _callbackSign(api, callback, context, nextTick){\n        if(Util.isFn(callback)) {\n            api = api.replace(/\\./g, '/');\n\n            let sn = WEB_CB_SN_PREFIX + Date.now();\n            let map = CALLBACKS[api] || (CALLBACKS[api] = {});\n            // let map = createNamespace(CALLBACKS, api.split(/\\./));\n            // 注意，箭头函数没有arguments！！\n            map[sn] = function(value) {\n                let args = SLICE.call(arguments);\n\n                if(!nextTick) {\n                    callback.apply(context, args);\n                } else {\n                    setTimeout(() => {\n                        callback.apply(context, args);\n                    }, 0);\n                }\n                delete map[sn];\n            };\n\n            return sn;\n        }\n        return '';\n    };\n\n\n    _invokeByUrlSchema(url){\n        window.location.href = url;\n    };\n\n    _findCallback(api, sn) {\n        api = api.replace(/\\./g, '/')\n        return (CALLBACKS[api] || {})[sn];\n    }\n\n}\n\nvar ns = new NativeSocket();\n\nHybridJS.core = ns;\n\nmodule.exports = ns;\n\n\n\n\n/** WEBPACK FOOTER **\n ** src/core/native-socket.js\n **/","//私有协议\nconst SCHEMA = \"cicada\";\n//暴露出来的API标识\nconst API_ROOT = \"HybridJS\";\n//浏览器ua\nconst UA = window.navigator.userAgent;\n//系统名称\nconst OS_NAME = \"cicada\";\n//通信来源\nconst SOURCE = \"hybrid\";\nconst DE_BUG = true;\n\n\nmodule .exports = {\n    SCHEMA : SCHEMA,\n    API_ROOT : API_ROOT,\n    UA : UA,\n    OS_NAME : OS_NAME,\n    DE_BUG  : DE_BUG,\n    SOURCE : SOURCE\n}\n\n\n/** WEBPACK FOOTER **\n ** src/config.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\nimport {UA,DE_BUG,API_ROOT} from \"../config\";\n\n\nexport  default class Util {\n\n    /**\n     * 调试\n     * @param message\n     */\n    static log() {\n        var message = '';\n        if (DE_BUG) {\n\n            for (var i = 0; i < arguments.length; i++) {\n                if (arguments[i] instanceof Object)\n                    message += JSON.stringify(arguments[i]);\n                else\n                    message += arguments[i];\n            }\n            console.log(message);\n        }\n    }\n\n    static getRoot() {\n        if (!window[API_ROOT])\n            window[API_ROOT] = {};\n\n        return window[API_ROOT];\n    };\n\n    static isFn(fn) {\n        return typeof fn === 'function';\n    }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** src/util/util.js\n **/","/**\n * 事件模型\n * sherlock221b\n */\n\n\nimport {SCHEMA,API_ROOT,UA,OS_NAME,DE_BUG} from \"../config\";\nimport Util from \"../util/util\";\n\nvar HANDLERS = {};\n\nexport  default class  EventModel {\n\n    //绑定事件\n    static on(event,handler){\n        let fns = HANDLERS[event];\n\n        if(!Util.isFn(handler)) return false;\n\n        if(!handler.name) console.warn(`绑定事件 ${event} 请尽量不用匿名函数！`);\n\n        if(fns) {\n            if(!Array.isArray(fns)) fns = [fns];\n            if(Array.isArray(fns) && ~fns.indexOf(handler)) return false;\n            fns.push(handler);\n        } else {\n            fns = handler;\n        }\n\n        HANDLERS[event] = fns;\n        return true;\n    };\n\n\n    //取消绑定\n    static off(event, handler){\n        if(!(event in HANDLERS)) return false;\n        if(Util.isFn(handler)) {\n            let fns = HANDLERS[event];\n\n            if(Array.isArray(fns)) {\n                HANDLERS[event] = fns.filter((fn) => {\n                    return fn != handler;\n                });\n\n                return HANDLERS[event].length !== fns.length;\n            } else {\n                return fns == handler ? delete HANDLERS[event] : false;\n            }\n        } else {\n            return delete HANDLERS[event];\n        }\n    }\n\n    static emit(event,data){\n\n        if(!event) {\n            console.warn('Receive empty event');\n            return\n        }\n\n        let fns = HANDLERS[event];\n\n\n        if(!(event in HANDLERS)) {\n            console.warn('event %s has not emited', event);\n            return;\n        }\n\n        if(Array.isArray(fns)) fns.forEach((fn) => {fn(data)});\n        else if(Util.isFn(fns)) fns(data);\n\n\n        console.log(\"emit 绑定事件栈 : \",HANDLERS);\n    }\n}\n\n\n\n\nmodule.exports = EventModel;\n\n\n\n\n/** WEBPACK FOOTER **\n ** src/core/event-model.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\n\n\nimport Util  from  \"../util/util\";\nimport Toast from \"./toast\";\nimport Dialog from \"./dialog\";\n//import Header from \"./header\";\n\nUtil.getRoot().ui = {\n    toast : Toast,\n    dialog : Dialog\n    //header : Header\n};\n\n\n/** WEBPACK FOOTER **\n ** src/ui/ui.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\nimport Util from  \"../util/util\";\nlet HybridJS = Util.getRoot();\n\n\nexport  default class Toast {\n\n    /**\n     * 显示toast\n     * @param message\n     * @param duration 毫秒 如果duration = 0; 则一直显示\n     */\n    static show(message, duration) {\n\n        duration = duration || 2000;\n        HybridJS.core.invokeNative(\"ui.toast.toggle\", {message: message, show: true, duration: duration});\n    };\n\n    /**\n     * 隐藏toast\n     */\n    static hide() {\n        HybridJS.core.invokeNative(\"ui.toast.toggle\", {show: false});\n    };\n\n\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** src/ui/toast.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\nimport Util from  \"../util/util\";\nlet HybridJS = Util.getRoot();\n\n\nexport  default class Dialog {\n\n    static getDialogTypes() {\n        return {\n            //提示型弹窗\n            TIP_ALERT: \"1\",\n            //confirm型\n            CONFIRM: \"2\",\n            //Prompt型\n            PROMPT: \"3\"\n        };\n    }\n\n    /**\n     * 消息提示窗\n     * @param message\n     * @param title\n     */\n    static alert(message,title,options) {\n        var data = {\n            message : message\n        }\n\n        //第二个参数\n        if(title instanceof Object){\n            Dialog.show(Dialog.getDialogTypes().TIP_ALERT, message,null,title);\n        }\n        else{\n            Dialog.show(Dialog.getDialogTypes().TIP_ALERT, message,title,options);\n        }\n\n    };\n\n\n    /**\n     * 询问提示框\n     * @param message\n     * @param title\n     */\n    static confirm(message, title, options) {\n        Dialog.show(Dialog.getDialogTypes().CONFIRM, message, title, options);\n    };\n\n\n    static show(dialogType, message, title, options = {}) {\n        var DialogData = {\n            title: title || \"\",\n            message: message,\n            positiveButtonText: options.positiveButtonText || \"确定\",\n            cancelButtonText: options.cancelButtonText || \"取消\",\n            positiveCallBack: options.positiveCallBack || \"\",\n            cancelCallBack: options.cancelCallBack || \"\"\n        }\n\n\n        let TYPE = Dialog.getDialogTypes();\n        switch (dialogType){\n            case TYPE.TIP_ALERT :\n                HybridJS.core.invokeNative(\"ui.alert\", DialogData);\n                break;\n            case TYPE.CONFIRM :\n                HybridJS.core.invokeNative(\"ui.confirm\", DialogData);\n                break;\n            case TYPE.PROMPT :\n                HybridJS.core.invokeNative(\"ui.prompt\", DialogData);\n                break;\n        }\n\n    };\n\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** src/ui/dialog.js\n **/","/**\n * Created by jiaaobo on 16/4/10.\n */\n\nimport Util from  \"../util/util\";\nlet HybridJS = Util.getRoot();\n\n\nconst  NavigationType  = {\n    WEBVIEW : \"webview\",\n    NATIVE : \"native\",\n    PAGE   : \"page\"\n};\n\n class Navigation {\n\n     constructor() {\n\n    };\n\n     /**\n      * 跳转至原生界面\n      * @param topage\n      * @param params\n      */\n     forwardNative(topage,params,callBack){\n        this.forward(NavigationType.NATIVE,topage,params,callBack);\n     };\n\n     /**\n      * 跳转到新开webview页面\n      * @param topage\n      * @param params\n      */\n     forwardView(topage,params){\n         this.forward(NavigationType.WEBVIEW,topage,params);\n     };\n\n     /**\n      * 当前容器内跳转\n      * @param urlPage\n      * @param params\n      */\n     forwardPage(urlPage,params){\n        window.location.href = urlPage;\n     };\n\n\n    forward(type,topage,params,callBack) {\n\n        let api = \"ui.nav.forward\";\n\n        var data = {\n            type : type,\n            topage : topage\n        };\n\n        if(params)\n            data = Object.assign(data,params);\n\n        if(callBack){\n            data.req_fn = HybridJS.core.registerCallBack(api,callBack);\n        }\n        HybridJS.core.invokeNative(api,data);\n    };\n\n}\n\nconst nav = new Navigation();\nHybridJS.navigation = nav;\nmodule.exports = nav;\n\n\n\n/** WEBPACK FOOTER **\n ** src/navigation/navigation.js\n **/"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAHA;AACA;AAGA;AACA;AACA;AACA;;AAJA;AAAA;AACA;;;;;;;;;;AAJA;;AAoBA;AACA;AACA;;AAFA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;;AAXA;;AAeA;AACA;AAMA;AACA;AACA;AAXA;AACA;AAaA;AACA;;AA5BA;AACA;;AADA;AACA;;AADA;AAqCA;AADA;AACA;AAGA;AACA;AACA;AACA;AACA;;AA5CA;AACA;;AADA;;;;;;;;;;;;AA2DA;AACA;AACA;AACA;AACA;;AAJA;AACA;AAOA;AACA;AADA;AAGA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;;AAlBA;AAqBA;AACA;AACA;AACA;AACA;AADA;AAGA;;;AAPA;AAWA;AACA;AACA;AACA;AACA;AAHA;AAZA;;;;AAoBA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;;;;;;;;;;AAQA;AACA;AACA;AAMA;AACA;AACA;;;;;;;AAKA;AACA;;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AADA;AAHA;AAOA;AAVA;AACA;AAYA;AAAA;AAAA;AApBA;AACA;;AADA;AAsBA;;;;AAIA;AACA;;;;AAGA;AACA;AACA;;;;AAtLA;;;AA2LA;AACA;AACA;AACA;;;;;;;;;;AChNA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;;;;;;;;;;;;;;;;;;;ACNA;;;;;;;;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AADA;AAMA;AARA;;;;AAYA;AACA;AACA;AAEA;;;;AAGA;AACA;;;;AA5BA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACEA;AACA;AACA;;;;;;;;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AALA;AACA;AAOA;AACA;;;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAGA;AALA;AAOA;AAPA;AAHA;AAaA;AAbA;;;;AAiBA;AACA;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;AAEA;AACA;AACA;AAFA;AACA;AAIA;AAAA;AAAA;AACA;AAGA;;;;AA9DA;;;;;;AAqEA;;;;;;;;;;;;;;;;;;;;;;;;ACrEA;AACA;AACA;;AAFA;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AAEA;;;;;;;;;;;;;;AAOA;AACA;AACA;AACA;;;;;;;;;AAMA;AACA;;;;AAjBA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACHA;AACA;AAEA;;;;;;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AANA;;;;;;;;;;;AAeA;AACA;AACA;AADA;AACA;;AAFA;AAOA;AADA;AAIA;AAJA;;;;;;;;;;;AAeA;AACA;;;;AAIA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AASA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AANA;AAQA;AACA;AATA;;;;AAxDA;;;;;;;;;;;;;;;;;;;;;;;;ACHA;AACA;AAEA;AACA;AACA;AACA;AAHA;AACA;AAKA;AAEA;AAFA;AAEA;AACA;AAHA;;;;;;;;;AAWA;AACA;;;;;;;;;;;AAQA;AACA;;;;;;;;;;;AAQA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;AAEA;AACA;AADA;AAGA;;;;AAjDA;;;AAsDA;AACA;;;;","sourceRoot":""}